/**
 * @fileoverview added by tsickle
 * Generated from: lib/service/one-signal.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __awaiter, __decorate, __metadata } from "tslib";
import { Injectable, Inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { OneSignalOptions, } from '../interface';
import { ExecIf } from '../decorators';
import { BehaviorSubject } from 'rxjs';
import { map, shareReplay } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "../interface";
/**
 * @record
 */
function OnsSignalSubscribed() { }
if (false) {
    /** @type {?} */
    OnsSignalSubscribed.prototype.isSubscribed;
    /** @type {?} */
    OnsSignalSubscribed.prototype.userId;
    /** @type {?} */
    OnsSignalSubscribed.prototype.registrationId;
    /** @type {?} */
    OnsSignalSubscribed.prototype.notificationPermission;
    /** @type {?} */
    OnsSignalSubscribed.prototype.optedOut;
    /** @type {?} */
    OnsSignalSubscribed.prototype.serviceWorkerActive;
}
/** @type {?} */
const isSubscribe = (/**
 * @param {?} __0
 * @return {?}
 */
({ isSubscribed, userId, registrationId, notificationPermission, optedOut, serviceWorkerActive, }) => isSubscribed &&
    Boolean(userId) &&
    Boolean(registrationId) &&
    notificationPermission === 'granted' &&
    optedOut === false &&
    Boolean(serviceWorkerActive));
const ɵ0 = isSubscribe;
/** @type {?} */
const hasSubsctibed = (/**
 * @param {?} oneSignal
 * @return {?}
 */
(oneSignal) => Promise.all([
    oneSignal.isPushNotificationsEnabled(),
    oneSignal.getUserId(),
    oneSignal.getRegistrationId(),
    oneSignal.getNotificationPermission(),
    oneSignal.isOptedOut(),
    oneSignal.context.serviceWorkerManager.getActiveState(),
]).then((/**
 * @param {?} __0
 * @return {?}
 */
([isSubscribed, userId, registrationId, notificationPermission, optedOut, serviceWorkerActive,]) => ({
    isSubscribed,
    userId,
    registrationId,
    notificationPermission,
    optedOut,
    serviceWorkerActive,
}))));
const ɵ1 = hasSubsctibed;
// @dynamic
export class OneSignalService {
    /**
     * @param {?} doc
     * @param {?} options
     */
    constructor(doc, options) {
        this.doc = doc;
        this.options = options;
        this.scriptinitalize = false;
        this.scriptURL = 'https://cdn.onesignal.com/sdks/OneSignalSDK.js';
        this.isSupportedSubject$ = new BehaviorSubject(false);
        this.SubscribeStateSubject$ = new BehaviorSubject({
            isSubscribed: false,
            userId: '',
            registrationId: '',
            notificationPermission: '',
            optedOut: true,
            serviceWorkerActive: '',
        });
        this.isOptedOutSubject$ = new BehaviorSubject(false);
        this.isPushNotificationsEnabledSubject$ = new BehaviorSubject(false);
        this.userIdSubject$ = new BehaviorSubject(null);
        /**
         * @see {\@link https://documentation.onesignal.com/docs/web-push-sdk#ispushnotificationssupported}
         */
        this.isSupported$ = this.isSupportedSubject$.asObservable();
        /**
         * @see {\@link https://documentation.onesignal.com/docs/web-push-sdk#ispushnotificationsenabled}
         */
        this.isPushNotificationsEnabled$ = this.isPushNotificationsEnabledSubject$.asObservable();
        /**
         * @see {\@link https://documentation.onesignal.com/docs/troubleshooting-web-push#3-check-if-you-are-subscribed}
         */
        this.subscribeState$ = this.SubscribeStateSubject$.asObservable().pipe(shareReplay(1));
        /**
         * @see {\@link https://documentation.onesignal.com/docs/troubleshooting-web-push#3-check-if-you-are-subscribed}
         */
        this.isSubscribe$ = this.subscribeState$.pipe(map(isSubscribe));
        this.userId$ = this.userIdSubject$.asObservable();
        this.init();
    }
    /**
     * @return {?}
     */
    get isSupported() {
        return this.isSupportedSubject$.value;
    }
    /**
     * @return {?}
     */
    get isSubscribe() {
        return isSubscribe(this.SubscribeStateSubject$.value);
    }
    /**
     * @return {?}
     */
    get isInitialized() {
        return this.scriptinitalize;
    }
    /**
     * @return {?}
     */
    get isOptedOut() {
        return this.isOptedOutSubject$.value;
    }
    /**
     * @return {?}
     */
    get userId() {
        return this.userIdSubject$.value;
    }
    /**
     * @return {?}
     */
    subscribe() {
        if (this.isSupported) {
            if (this.isOptedOutSubject$.value) {
                OneSignal.setSubscription(true);
            }
            else {
                OneSignal.registerForPushNotifications();
            }
        }
    }
    /**
     * call OneSignal.setSubscription(false)
     * @see {\@link https://documentation.onesignal.com/docs/web-push-sdk#section--setsubscription-}
     * @return {?}
     */
    unsubscribe() {
        if (this.isSubscribe) {
            OneSignal.setSubscription(false);
        }
    }
    /**
     * https://documentation.onesignal.com/docs/web-push-sdk#section-loading-sdk-asynchronously
     * \@example
     * ngxOneSignal.push(['sendTag', 'key', 'value', function(tagsSent) {
     *   // Callback called when tags have finished sending
     * }]);
     * // or
     * ngxOneSignal.push(['sendTag', 'key', 'value']).then((tagsSent) => {
     *   // Callback called when tags have finished sending
     * });
     * @param {?} items push(["functionName", param1, param2]);
     * @return {?}
     */
    push(items) {
        if (this.isSupported) {
            return OneSignal.push(items);
        }
        else {
            return Promise.resolve();
        }
    }
    /**
     * @private
     * @return {?}
     */
    init() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                if (!this.scriptinitalize) {
                    yield this.addScript();
                    yield this.initOneSignal();
                    this.scriptinitalize = true;
                }
            }
            catch (_a) {
                this.scriptinitalize = false;
            }
        });
    }
    /**
     * @private
     * @return {?}
     */
    addScript() {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            /** @type {?} */
            const head = this.doc.getElementsByTagName('head')[0];
            /** @type {?} */
            const script = this.doc.createElement('script');
            script.type = 'text/javascript';
            script.onload = resolve;
            script.onerror = reject;
            script.src = this.scriptURL;
            head.appendChild(script);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    initOneSignal() {
        return __awaiter(this, void 0, void 0, function* () {
            yield OneSignal.init(Object.assign({}, this.options));
            yield OneSignal.on('subscriptionChange', (/**
             * @return {?}
             */
            () => __awaiter(this, void 0, void 0, function* () {
                this.SubscribeStateSubject$.next(yield hasSubsctibed(OneSignal));
            })));
            // https://documentation.onesignal.com/docs/web-push-sdk#section-subscription-change
            this.isSupportedSubject$.next(yield OneSignal.isPushNotificationsSupported());
            this.isPushNotificationsEnabledSubject$.next(yield OneSignal.isPushNotificationsEnabled());
            this.isOptedOutSubject$.next(yield OneSignal.isOptedOut());
            this.SubscribeStateSubject$.next(yield hasSubsctibed(OneSignal));
            this.userIdSubject$.next(yield OneSignal.getUserId());
        });
    }
}
OneSignalService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
/** @nocollapse */
OneSignalService.ctorParameters = () => [
    { type: Document, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: OneSignalOptions }
];
/** @nocollapse */ OneSignalService.ɵprov = i0.ɵɵdefineInjectable({ factory: function OneSignalService_Factory() { return new OneSignalService(i0.ɵɵinject(i1.DOCUMENT), i0.ɵɵinject(i2.OneSignalOptions)); }, token: OneSignalService, providedIn: "root" });
__decorate([
    ExecIf('isInitialized'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], OneSignalService.prototype, "subscribe", null);
__decorate([
    ExecIf('isInitialized'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], OneSignalService.prototype, "unsubscribe", null);
__decorate([
    ExecIf('isInitialized'),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Array]),
    __metadata("design:returntype", void 0)
], OneSignalService.prototype, "push", null);
if (false) {
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.scriptinitalize;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.scriptURL;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.isSupportedSubject$;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.SubscribeStateSubject$;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.isOptedOutSubject$;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.isPushNotificationsEnabledSubject$;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.userIdSubject$;
    /**
     * @see {\@link https://documentation.onesignal.com/docs/web-push-sdk#ispushnotificationssupported}
     * @type {?}
     */
    OneSignalService.prototype.isSupported$;
    /**
     * @see {\@link https://documentation.onesignal.com/docs/web-push-sdk#ispushnotificationsenabled}
     * @type {?}
     */
    OneSignalService.prototype.isPushNotificationsEnabled$;
    /**
     * @see {\@link https://documentation.onesignal.com/docs/troubleshooting-web-push#3-check-if-you-are-subscribed}
     * @type {?}
     */
    OneSignalService.prototype.subscribeState$;
    /**
     * @see {\@link https://documentation.onesignal.com/docs/troubleshooting-web-push#3-check-if-you-are-subscribed}
     * @type {?}
     */
    OneSignalService.prototype.isSubscribe$;
    /** @type {?} */
    OneSignalService.prototype.userId$;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.doc;
    /**
     * @type {?}
     * @private
     */
    OneSignalService.prototype.options;
}
export { ɵ0, ɵ1 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib25lLXNpZ25hbC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9tLnNha2FtYWtpL3Byb2plY3Qvc2FrYW1ha2kvbmd4LW9uZXNpZ25hbC9wcm9qZWN0cy9uZ3gtb25lc2lnbmFsL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL29uZS1zaWduYWwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUVMLGdCQUFnQixHQUVqQixNQUFNLGNBQWMsQ0FBQztBQUN0QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7OztBQUlsRCxrQ0FPQzs7O0lBTkMsMkNBQXNCOztJQUN0QixxQ0FBZTs7SUFDZiw2Q0FBdUI7O0lBQ3ZCLHFEQUErQjs7SUFDL0IsdUNBQWtCOztJQUNsQixrREFBNEI7OztNQUd4QixXQUFXOzs7O0FBQUcsQ0FBQyxFQUNuQixZQUFZLEVBQ1osTUFBTSxFQUNOLGNBQWMsRUFDZCxzQkFBc0IsRUFDdEIsUUFBUSxFQUNSLG1CQUFtQixHQUNDLEVBQVcsRUFBRSxDQUNqQyxZQUFZO0lBQ1osT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUNmLE9BQU8sQ0FBQyxjQUFjLENBQUM7SUFDdkIsc0JBQXNCLEtBQUssU0FBUztJQUNwQyxRQUFRLEtBQUssS0FBSztJQUNsQixPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQTs7O01BRXhCLGFBQWE7Ozs7QUFBRyxDQUNwQixTQUF3QixFQUNNLEVBQUUsQ0FDaEMsT0FBTyxDQUFDLEdBQUcsQ0FBQztJ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TUFBTSxDQUFDLGVBQWUsQ0FBQzs7OzttREFLdkI7QUFlRDtJQURDLE1BQU0sQ0FBQyxlQUFlLENBQUM7Ozs7NENBT3ZCOzs7Ozs7SUFyR0QsMkNBQWdDOzs7OztJQUNoQyxxQ0FBOEU7Ozs7O0lBRTlFLCtDQUEyRTs7Ozs7SUFDM0Usa0RBU0c7Ozs7O0lBQ0gsOENBQTBFOzs7OztJQUMxRSw4REFFUzs7Ozs7SUFDVCwwQ0FBMkU7Ozs7O0lBSzNFLHdDQUF1RTs7Ozs7SUFJdkUsdURBQXFHOzs7OztJQUlyRywyQ0FFRTs7Ozs7SUFJRix3Q0FBMkU7O0lBQzNFLG1DQUE2RDs7Ozs7SUFrRTNELCtCQUFnRDs7Ozs7SUFDaEQsbUNBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBPbmVTaWduYWxTdHViLFxuICBPbmVTaWduYWxPcHRpb25zLFxuICBPbmVTaWduYWxTdHViRnVuY2lvbkxpc3QsXG59IGZyb20gJy4uL2ludGVyZmFjZSc7XG5pbXBvcnQgeyBFeGVjSWYgfSBmcm9tICcuLi9kZWNvcmF0b3JzJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzaGFyZVJlcGxheSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuZGVjbGFyZSB2YXIgT25lU2lnbmFsOiBPbmVTaWduYWxTdHViO1xuXG5pbnRlcmZhY2UgT25zU2lnbmFsU3Vic2NyaWJlZCB7XG4gIGlzU3Vic2NyaWJlZDogYm9vbGVhbjtcbiAgdXNlcklkOiBzdHJpbmc7XG4gIHJlZ2lzdHJhdGlvbklkOiBzdHJpbmc7XG4gIG5vdGlmaWNhdGlvblBlcm1pc3Npb246IHN0cmluZztcbiAgb3B0ZWRPdXQ6IGJvb2xlYW47XG4gIHNlcnZpY2VXb3JrZXJBY3RpdmU6IHN0cmluZztcbn1cblxuY29uc3QgaXNTdWJzY3JpYmUgPSAoe1xuICBpc1N1YnNjcmliZWQsXG4gIHVzZXJJZCxcbiAgcmVnaXN0cmF0aW9uSWQsXG4gIG5vdGlmaWNhdGlvblBlcm1pc3Npb24sXG4gIG9wdGVkT3V0LFxuICBzZXJ2aWNlV29ya2VyQWN0aXZlLFxufTogT25zU2lnbmFsU3Vic2NyaWJlZCk6IGJvb2xlYW4gPT5cbiAgaXNTdWJzY3JpYmVkICYmXG4gIEJvb2xlYW4odXNlcklkKSAmJlxuICBCb29sZWFuKHJlZ2lzdHJhdGlvbklkKSAmJlxuICBub3RpZmljYXRpb25QZXJtaXNzaW9uID09PSAnZ3JhbnRlZCcgJiZcbiAgb3B0ZWRPdXQgPT09IGZhbHNlICYmXG4gIEJvb2xlYW4oc2VydmljZVdvcmtlckFjdGl2ZSk7XG5cbmNvbnN0IGhhc1N1YnNjdGliZWQgPSAoXG4gIG9uZVNpZ25hbDogT25lU2lnbmFsU3R1Yixcbik6IFByb21pc2U8T25zU2lnbmFsU3Vic2NyaWJlZD4gPT5cbiAgUHJvbWlzZS5hbGwoW1xuICAgIG9uZVNpZ25hbC5pc1B1c2hOb3RpZmljYXRpb25zRW5hYmxlZCgpLFxuICAgIG9uZVNpZ25hbC5nZXRVc2VySWQoKSxcbiAgICBvbmVTaWduYWwuZ2V0UmVnaXN0cmF0aW9uSWQoKSxcbiAgICBvbmVTaWduYWwuZ2V0Tm90aWZpY2F0aW9uUGVybWlzc2lvbigpLFxuICAgIG9uZVNpZ25hbC5pc09wdGVkT3V0KCksXG4gICAgb25lU2lnbmFsLmNvbnRleHQuc2VydmljZVdvcmtlck1hbmFnZXIuZ2V0QWN0aXZlU3RhdGUoKSxcbiAgXSkudGhlbihcbiAgICAoW1xuICAgICAgaXNTdWJzY3JpYmVkLFxuICAgICAgdXNlcklkLFxuICAgICAgcmVnaXN0cmF0aW9uSWQsXG4gICAgICBub3RpZmljYXRpb25QZXJtaXNzaW9uLFxuICAgICAgb3B0ZWRPdXQsXG4gICAgICBzZXJ2aWNlV29ya2VyQWN0aXZlLFxuICAgIF0pID0+ICh7XG4gICAgICBpc1N1YnNjcmliZWQsXG4gICAgICB1c2VySWQsXG4gICAgICByZWdpc3RyYXRpb25JZCxcbiAgICAgIG5vdGlmaWNhdGlvblBlcm1pc3Npb24sXG4gICAgICBvcHRlZE91dCxcbiAgICAgIHNlcnZpY2VXb3JrZXJBY3RpdmUsXG4gICAgfSksXG4gICk7XG5cbi8vIEBkeW5hbWljXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgT25lU2lnbmFsU2VydmljZSB7XG4gIHByaXZhdGUgc2NyaXB0aW5pdGFsaXplID0gZmFsc2U7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2NyaXB0VVJMID0gJ2h0dHBzOi8vY2RuLm9uZXNpZ25hbC5jb20vc2Rrcy9PbmVTaWduYWxTREsuanMnO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgaXNTdXBwb3J0ZWRTdWJqZWN0JCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4oZmFsc2UpO1xuICBwcml2YXRlIHJlYWRvbmx5IFN1YnNjcmliZVN0YXRlU3ViamVjdCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFxuICAgIE9uc1NpZ25hbFN1YnNjcmliZWRcbiAgPih7XG4gICAgaXNTdWJzY3JpYmVkOiBmYWxzZSxcbiAgICB1c2VySWQ6ICcnLFxuICAgIHJlZ2lzdHJhdGlvbklkOiAnJyxcbiAgICBub3RpZmljYXRpb25QZXJtaXNzaW9uOiAnJyxcbiAgICBvcHRlZE91dDogdHJ1ZSxcbiAgICBzZXJ2aWNlV29ya2VyQWN0aXZlOiAnJyxcbiAgfSk7XG4gIHByaXZhdGUgcmVhZG9ubHkgaXNPcHRlZE91dFN1YmplY3QkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPihmYWxzZSk7XG4gIHByaXZhdGUgcmVhZG9ubHkgaXNQdXNoTm90aWZpY2F0aW9uc0VuYWJsZWRTdWJqZWN0JCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8XG4gICAgYm9vbGVhblxuICA+KGZhbHNlKTtcbiAgcHJpdmF0ZSByZWFkb25seSB1c2VySWRTdWJqZWN0JCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG5cbiAgLyoqXG4gICAqIEBzZWUge0BsaW5rIGh0dHBzOi8vZG9jdW1lbnRhdGlvbi5vbmVzaWduYWwuY29tL2RvY3Mvd2ViLXB1c2gtc2RrI2lzcHVzaG5vdGlmaWNhdGlvbnNzdXBwb3J0ZWR9XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgaXNTdXBwb3J0ZWQkID0gdGhpcy5pc1N1cHBvcnRlZFN1YmplY3QkLmFzT2JzZXJ2YWJsZSgpO1xuICAvKipcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9kb2N1bWVudGF0aW9uLm9uZXNpZ25hbC5jb20vZG9jcy93ZWItcHVzaC1zZGsjaXNwdXNobm90aWZpY2F0aW9uc2VuYWJsZWR9XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgaXNQdXNoTm90aWZpY2F0aW9uc0VuYWJsZWQkID0gdGhpcy5pc1B1c2hOb3RpZmljYXRpb25zRW5hYmxlZFN1YmplY3QkLmFzT2JzZXJ2YWJsZSgpO1xuICAvKipcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9kb2N1bWVudGF0aW9uLm9uZXNpZ25hbC5jb20vZG9jcy90cm91Ymxlc2hvb3Rpbmctd2ViLXB1c2gjMy1jaGVjay1pZi15b3UtYXJlLXN1YnNjcmliZWR9XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc3Vic2NyaWJlU3RhdGUkID0gdGhpcy5TdWJzY3JpYmVTdGF0ZVN1YmplY3QkLmFzT2JzZXJ2YWJsZSgpLnBpcGUoXG4gICAgc2hhcmVSZXBsYXkoMSksXG4gICk7XG4gIC8qKlxuICAgKiBAc2VlIHtAbGluayBodHRwczovL2RvY3VtZW50YXRpb24ub25lc2lnbmFsLmNvbS9kb2NzL3Ryb3VibGVzaG9vdGluZy13ZWItcHVzaCMzLWNoZWNrLWlmLXlvdS1hcmUtc3Vic2NyaWJlZH1cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpc1N1YnNjcmliZSQgPSB0aGlzLnN1YnNjcmliZVN0YXRlJC5waXBlKG1hcChpc1N1YnNjcmliZSkpO1xuICBwdWJsaWMgcmVhZG9ubHkgdXNlcklkJCA9IHRoaXMudXNlcklkU3ViamVjdCQuYXNPYnNlcnZhYmxlKCk7XG5cbiAgcHVibGljIGdldCBpc1N1cHBvcnRlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc1N1cHBvcnRlZFN1YmplY3QkLnZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldCBpc1N1YnNjcmliZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gaXNTdWJzY3JpYmUodGhpcy5TdWJzY3JpYmVTdGF0ZVN1YmplY3QkLnZhbHVlKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgaXNJbml0aWFsaXplZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zY3JpcHRpbml0YWxpemU7XG4gIH1cblxuICBwdWJsaWMgZ2V0IGlzT3B0ZWRPdXQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNPcHRlZE91dFN1YmplY3QkLnZhbHVlO1xuICB9XG5cbiAgcHVibGljIGdldCB1c2VySWQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy51c2VySWRTdWJqZWN0JC52YWx1ZTtcbiAgfVxuXG4gIEBFeGVjSWYoJ2lzSW5pdGlhbGl6ZWQnKVxuICBwdWJsaWMgc3Vic2NyaWJlKCkge1xuICAgIGlmICh0aGlzLmlzU3VwcG9ydGVkKSB7XG4gICAgICBpZiAodGhpcy5pc09wdGVkT3V0U3ViamVjdCQudmFsdWUpIHtcbiAgICAgICAgT25lU2lnbmFsLnNldFN1YnNjcmlwdGlvbih0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIE9uZVNpZ25hbC5yZWdpc3RlckZvclB1c2hOb3RpZmljYXRpb25zKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGNhbGwgT25lU2lnbmFsLnNldFN1YnNjcmlwdGlvbihmYWxzZSlcbiAgICogQHNlZSB7QGxpbmsgaHR0cHM6Ly9kb2N1bWVudGF0aW9uLm9uZXNpZ25hbC5jb20vZG9jcy93ZWItcHVzaC1zZGsjc2VjdGlvbi0tc2V0c3Vic2NyaXB0aW9uLX1cbiAgICovXG4gIEBFeGVjSWYoJ2lzSW5pdGlhbGl6ZWQnKVxuICBwdWJsaWMgdW5zdWJzY3JpYmUoKSB7XG4gICAgaWYgKHRoaXMuaXNTdWJzY3JpYmUpIHtcbiAgICAgIE9uZVNpZ25hbC5zZXRTdWJzY3JpcHRpb24oZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBodHRwczovL2RvY3VtZW50YXRpb24ub25lc2lnbmFsLmNvbS9kb2NzL3dlYi1wdXNoLXNkayNzZWN0aW9uLWxvYWRpbmctc2RrLWFzeW5jaHJvbm91c2x5XG4gICAqIEBwYXJhbSBpdGVtcyBwdXNoKFtcImZ1bmN0aW9uTmFtZVwiLCBwYXJhbTEsIHBhcmFtMl0pO1xuICAgKiBAZXhhbXBsZVxuICAgKiBuZ3hPbmVTaWduYWwucHVzaChbJ3NlbmRUYWcnLCAna2V5JywgJ3ZhbHVlJywgZnVuY3Rpb24odGFnc1NlbnQpIHtcbiAgICogICAvLyBDYWxsYmFjayBjYWxsZWQgd2hlbiB0YWdzIGhhdmUgZmluaXNoZWQgc2VuZGluZ1xuICAgKiB9XSk7XG4gICAqIC8vIG9yXG4gICAqIG5neE9uZVNpZ25hbC5wdXNoKFsnc2VuZFRhZycsICdrZXknLCAndmFsdWUnXSkudGhlbigodGFnc1NlbnQpID0+IHtcbiAgICogICAvLyBDYWxsYmFjayBjYWxsZWQgd2hlbiB0YWdzIGhhdmUgZmluaXNoZWQgc2VuZGluZ1xuICAgKiB9KTtcbiAgICovXG4gIEBFeGVjSWYoJ2lzSW5pdGlhbGl6ZWQnKVxuICBwdWJsaWMgcHVzaChpdGVtczogYW55W10pIHtcbiAgICBpZiAodGhpcy5pc1N1cHBvcnRlZCkge1xuICAgICAgcmV0dXJuIE9uZVNpZ25hbC5wdXNoKGl0ZW1zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgcmVhZG9ubHkgZG9jOiBEb2N1bWVudCxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG9wdGlvbnM6IE9uZVNpZ25hbE9wdGlvbnMsXG4gICkge1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0KCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXRoaXMuc2NyaXB0aW5pdGFsaXplKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRkU2NyaXB0KCk7XG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdE9uZVNpZ25hbCgpO1xuICAgICAgICB0aGlzLnNjcmlwdGluaXRhbGl6ZSA9IHRydWU7XG4gICAgICB9XG4gICAgfSBjYXRjaCB7XG4gICAgICB0aGlzLnNjcmlwdGluaXRhbGl6ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkU2NyaXB0KCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxFdmVudD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgaGVhZCA9IHRoaXMuZG9jLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgICBjb25zdCBzY3JpcHQgPSB0aGlzLmRvYy5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICBzY3JpcHQub25sb2FkID0gcmVzb2x2ZTtcbiAgICAgIHNjcmlwdC5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgc2NyaXB0LnNyYyA9IHRoaXMuc2NyaXB0VVJMO1xuICAgICAgaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbml0T25lU2lnbmFsKCkge1xuICAgIGF3YWl0IE9uZVNpZ25hbC5pbml0KHtcbiAgICAgIC4uLnRoaXMub3B0aW9ucyxcbiAgICB9KTtcblxuICAgIGF3YWl0IE9uZVNpZ25hbC5vbignc3Vic2NyaXB0aW9uQ2hhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5TdWJzY3JpYmVTdGF0ZVN1YmplY3QkLm5leHQoYXdhaXQgaGFzU3Vic2N0aWJlZChPbmVTaWduYWwpKTtcbiAgICB9KTtcblxuICAgIC8vIGh0dHBzOi8vZG9jdW1lbnRhdGlvbi5vbmVzaWduYWwuY29tL2RvY3Mvd2ViLXB1c2gtc2RrI3NlY3Rpb24tc3Vic2NyaXB0aW9uLWNoYW5nZVxuICAgIHRoaXMuaXNTdXBwb3J0ZWRTdWJqZWN0JC5uZXh0KFxuICAgICAgYXdhaXQgT25lU2lnbmFsLmlzUHVzaE5vdGlmaWNhdGlvbnNTdXBwb3J0ZWQoKSxcbiAgICApO1xuICAgIHRoaXMuaXNQdXNoTm90aWZpY2F0aW9uc0VuYWJsZWRTdWJqZWN0JC5uZXh0KFxuICAgICAgYXdhaXQgT25lU2lnbmFsLmlzUHVzaE5vdGlmaWNhdGlvbnNFbmFibGVkKCksXG4gICAgKTtcbiAgICB0aGlzLmlzT3B0ZWRPdXRTdWJqZWN0JC5uZXh0KGF3YWl0IE9uZVNpZ25hbC5pc09wdGVkT3V0KCkpO1xuICAgIHRoaXMuU3Vic2NyaWJlU3RhdGVTdWJqZWN0JC5uZXh0KGF3YWl0IGhhc1N1YnNjdGliZWQoT25lU2lnbmFsKSk7XG4gICAgdGhpcy51c2VySWRTdWJqZWN0JC5uZXh0KGF3YWl0IE9uZVNpZ25hbC5nZXRVc2VySWQoKSk7XG4gIH1cbn1cbiJdfQ==